<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="format-detection" content="telephone=no">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no">
        <style>
            .toast{
                width: 12em;position: fixed;
                left: 50%;margin-left: -6em;bottom: 8em;z-index: 300;
            }
            .toast-item{
                position: absolute;left: 0;top: 0;right: 0;
                padding: 0.8em 0;background-color: #333;border-radius: 5px;color: #fff;opacity: 0;text-align: center;
                transform : translate3d(0,100%,0);
                -webkit-transform : translate3d(0,100%,0);
                transition: all 0.8s;
                -webkit-transition: all 0.8s;
            }
            .toast-item-show{
                transform : translate3d(0,0,0);
                -webkit-transform : translate3d(0,0,0);
                opacity : 1;
            }
            .toast-item-hide{
                opacity: 0;
            }
        </style>
        <title></title>
    </head>
    <body ms-controller="body">
        <button ms-click="@show">show</button>

        <div class='toast' :visible='@_isShow'>
             <div class='toast-item' :for='el in @items' :class='{"toast-item-show" : el.toastItemShow,"toast-item-hide" : el.toastItemHide}' :on-transitionend='@_transitionend(el,$event)'>{{el.text}}</div>
        </div>

        <script src="../dist/avalon.js"></script>
        <script>
//获取所有子元素，非文本节点
avalon.fn.children = function (i) {
   return this[0].children[i]
//    var children = [];
//    avalon.each(this[0].childNodes, function (i, node) {
//        node.nodeType === 1 && children.push(node);
//    });
//    if (i !== undefined) {
//        return children[i];
//    }
//    return children;
};
avalon.define({
    $id: "body",
    show: function () {
        this.open('testtest');
    },
    _isShow: false,
    _transitionend: function (el, e) {
        if (e.propertyName !== 'opacity')
            return;
        // console.log(el.text);
        if (el.toastItemHide) {
            this.items.remove(el);
            if (this.items.length === 0) {
                this._isShow = false;
            }
        } else {
            setTimeout(function () {
                el.toastItemHide = true;
            }, 800);
        }
    },
    items: [],
    open: function (msg) {
        var items = this.items;
        if (items.length === 0)
            this._isShow = true;
        items.push({
            toastItemShow: false,
            text: items.length + 1,
            toastItemHide: false
        });
        var index = items.length - 1;
        var target = items[index];
        //reflow
       var a = avalon(this.$element).children(index)
       if(a){
           a.offsetWidth;
       }
               
        target.toastItemShow = true;
    }
});
        </script>
    </body>
</html>